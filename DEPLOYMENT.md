# Silver Nails - Deployment Guide

This guide covers deploying Silver Nails to Vercel, the recommended hosting platform for TanStack Start applications.

## Prerequisites

- âœ“ Git repository (GitHub, GitLab, or Bitbucket)
- âœ“ Vercel account (free tier works great)
- âœ“ Notion databases set up (see NOTION_SETUP.md)
- âœ“ All environment variables ready

## Quick Deploy to Vercel

### Option 1: Deploy with Vercel CLI (Recommended)

```bash
# Install Vercel CLI globally
npm i -g vercel

# Login to Vercel
vercel login

# Deploy
vercel

# Follow the prompts:
# - Set up and deploy? Yes
# - Which scope? Select your account
# - Link to existing project? No
# - What's your project's name? silver-nails
# - In which directory is your code located? ./
# - Want to override settings? No

# After first deployment, subsequent deployments:
vercel --prod
```

### Option 2: Deploy via Vercel Dashboard

1. **Push code to GitHub**

   ```bash
   git add .
   git commit -m "feat: initial deployment"
   git push origin main
   ```

2. **Import Project in Vercel**
   - Go to [vercel.com/new](https://vercel.com/new)
   - Click "Import Project"
   - Select your Git provider (GitHub recommended)
   - Find and select `silver-nails` repository
   - Click "Import"

3. **Configure Project**
   - **Framework Preset**: Vite
   - **Root Directory**: `./`
   - **Build Command**: `pnpm build`
   - **Output Directory**: `.output/public`
   - **Install Command**: `pnpm install`

4. **Add Environment Variables** (see below)

5. **Click "Deploy"**

## Environment Variables Configuration

In Vercel Dashboard â†’ Project Settings â†’ Environment Variables, add:

### Required Variables

```env
# Notion API
NOTION_API_KEY=secret_abc123...
NOTION_DB_USERS=database_id_here
NOTION_DB_STAFF=database_id_here
NOTION_DB_SERVICES=database_id_here
NOTION_DB_APPOINTMENTS=database_id_here
NOTION_DB_PAYMENTS=database_id_here
NOTION_DB_LOYALTY=database_id_here
NOTION_DB_REVIEWS=database_id_here
NOTION_DB_GALLERY=database_id_here

# Authentication (generate secure random string)
JWT_SECRET=your_super_secret_jwt_key_minimum_32_characters

# Site Configuration
SITE_URL=https://your-domain.vercel.app
```

### Optional Variables (for future features)

```env
# Email Notifications (when implemented)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# PayPal (when implemented)
PAYPAL_CLIENT_ID = your_paypal_client_id
PAYPAL_SECRET    = your_paypal_secret
PAYPAL_MODE      = sandbox  # or 'production'

# Analytics (optional)
GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX
```

**Important**:

- Set environment for all environments (Production, Preview, Development)
- Or select specific environments as needed
- Never commit `.env` file to Git

## Vercel Configuration

Create `vercel.json` in project root:

```json
{
  "buildCommand": "pnpm build",
  "devCommand": "pnpm dev",
  "installCommand": "pnpm install",
  "framework": "vite",
  "outputDirectory": ".output/public",
  "regions": ["iad1"],
  "functions": {
    "api/**/*.ts": {
      "runtime": "nodejs20.x"
    }
  }
}
```

## Custom Domain Setup

### Add Custom Domain

1. **Purchase Domain** (if needed)
   - Recommended: Namecheap, Google Domains, Cloudflare

2. **Add Domain in Vercel**
   - Go to Project Settings â†’ Domains
   - Click "Add Domain"
   - Enter your domain (e.g., `silvernails.com`)
   - Click "Add"

3. **Configure DNS**

   **Option A: Use Vercel Nameservers (Recommended)**
   - Vercel provides nameservers
   - Update nameservers in your domain registrar
   - Vercel handles all DNS automatically

   **Option B: CNAME Record**
   - Add CNAME record in your DNS provider:
     ```
     Type: CNAME
     Name: www (or @)
     Value: cname.vercel-dns.com
     ```

4. **Wait for DNS Propagation** (up to 48 hours, usually < 1 hour)

5. **SSL Certificate** - Auto-generated by Vercel

### Configure WWW and Apex Domain

```
# Add both:
silvernails.com (apex)
www.silvernails.com (www)

# Set one as redirect to the other in Vercel settings
```

## Performance Optimization

### 1. Enable Vercel Speed Insights

```bash
pnpm add @vercel/speed-insights
```

In `src/routes/__root.tsx`:

```tsx
import { SpeedInsights } from "@vercel/speed-insights/react";

// Add to RootDocument:
<SpeedInsights />;
```

### 2. Enable Vercel Analytics

```bash
pnpm add @vercel/analytics
```

```tsx
import { Analytics } from "@vercel/analytics/react";

// Add to RootDocument:
<Analytics />;
```

### 3. Configure Edge Functions (Optional)

For faster global performance:

```typescript
// In route files where needed:
export const runtime = "edge";
```

### 4. Image Optimization

Use Vercel's automatic image optimization:

```tsx
// Instead of <img>:
import Image from "next/image"; // Or use Vercel's image component

<Image
  src="/nail-art.jpg"
  alt="Nail Art"
  width={800}
  height={600}
  quality={85}
/>;
```

## Monitoring & Observability

### 1. Vercel Dashboard

Monitor:

- Deployment status
- Build logs
- Function logs
- Analytics
- Speed Insights

### 2. Error Tracking (Optional)

Add Sentry for error tracking:

```bash
pnpm add @sentry/react @sentry/vite-plugin
```

Configure in `vite.config.ts` and application.

### 3. Uptime Monitoring

Recommended services:

- UptimeRobot (free)
- Pingdom
- StatusCake

## CI/CD Pipeline

Vercel provides automatic CI/CD:

### Automatic Deployments

- **Production**: Deploys on push to `main` branch
- **Preview**: Deploys on all other branches and PRs
- **Development**: Local development only

### Branch Protection (Recommended)

In GitHub:

1. Go to Settings â†’ Branches
2. Add rule for `main` branch:
   - Require pull request reviews
   - Require status checks (Vercel deployments)
   - No direct pushes to main

### Deployment Workflow

```
1. Create feature branch
   git checkout -b feature/booking-system

2. Make changes and commit
   git add .
   git commit -m "feat: add booking system"
   git push origin feature/booking-system

3. Create Pull Request on GitHub
   â†’ Vercel creates preview deployment
   â†’ Review changes on preview URL

4. Merge to main
   â†’ Vercel deploys to production automatically

5. Production live at your domain!
```

## Rollback Strategy

### Quick Rollback

1. **Via Vercel Dashboard**
   - Go to Deployments
   - Find previous working deployment
   - Click "..." â†’ "Promote to Production"

2. **Via Git**

   ```bash
   # Revert to previous commit
   git revert HEAD
   git push origin main
   ```

3. **Via Vercel CLI**
   ```bash
   # Promote specific deployment
   vercel promote <deployment-url>
   ```

## Environment-Specific Configurations

### Development

```env
SITE_URL=http://localhost:3000
PAYPAL_MODE=sandbox
LOG_LEVEL=debug
```

### Staging (Preview)

```env
SITE_URL=https://silver-nails-git-staging.vercel.app
PAYPAL_MODE=sandbox
LOG_LEVEL=info
```

### Production

```env
SITE_URL=https://silvernails.com
PAYPAL_MODE=production
LOG_LEVEL=error
```

## Security Checklist

Before going live:

- [ ] Environment variables set correctly
- [ ] No sensitive data in code
- [ ] HTTPS enabled (automatic with Vercel)
- [ ] CORS configured properly
- [ ] Rate limiting implemented (if needed)
- [ ] Input validation working
- [ ] Authentication implemented
- [ ] Database access restricted
- [ ] API keys rotated from defaults
- [ ] Error messages don't leak sensitive info
- [ ] Dependencies up to date
- [ ] Security headers configured

### Security Headers

Add to `vercel.json`:

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        },
        {
          "key": "Referrer-Policy",
          "value": "strict-origin-when-cross-origin"
        }
      ]
    }
  ]
}
```

## Pre-Launch Checklist

### Technical

- [ ] All pages loading correctly
- [ ] Mobile responsive on all devices
- [ ] Forms submitting properly
- [ ] Booking system tested end-to-end
- [ ] Payment integration tested (sandbox)
- [ ] Email notifications working
- [ ] Error pages customized (404, 500)
- [ ] Lighthouse score > 90
- [ ] Load testing completed

### Content

- [ ] All text proofread
- [ ] Images optimized
- [ ] Services and pricing updated
- [ ] Staff profiles complete
- [ ] Gallery populated
- [ ] Contact information verified
- [ ] Business hours correct
- [ ] Privacy policy added
- [ ] Terms of service added

### SEO

- [ ] Meta tags on all pages
- [ ] Sitemap generated
- [ ] robots.txt configured
- [ ] Google Analytics set up
- [ ] Google Search Console verified
- [ ] Social media meta tags
- [ ] Schema.org markup added

### Business

- [ ] Test bookings with real customers
- [ ] Staff trained on admin panel
- [ ] Payment processing tested
- [ ] Backup procedures established
- [ ] Support email set up
- [ ] Social media accounts linked
- [ ] Launch announcement prepared

## Post-Launch

### Week 1

1. Monitor error logs daily
2. Check booking success rate
3. Gather user feedback
4. Fix critical issues
5. Update documentation

### Month 1

1. Review analytics
2. Optimize conversion funnel
3. A/B test CTAs
4. Gather customer testimonials
5. Plan feature iterations

### Ongoing

- Weekly analytics review
- Monthly security updates
- Quarterly performance optimization
- Customer feedback integration
- Feature roadmap updates

## Troubleshooting

### Build Fails

**Check**:

- Build logs in Vercel dashboard
- TypeScript errors: `pnpm build` locally
- Dependency issues: Delete `node_modules`, run `pnpm install`
- Environment variables: Ensure all required vars are set

### Runtime Errors

**Check**:

- Function logs in Vercel
- Notion API rate limits
- Environment variable values
- API endpoint responses

### Slow Performance

**Optimize**:

- Enable Edge Functions
- Add image optimization
- Implement caching headers
- Use Vercel Analytics to identify bottlenecks

### Database Issues

**Verify**:

- Notion integration still has access
- Database IDs are correct
- API key hasn't expired
- Rate limits not exceeded

## Support Resources

- **Vercel Documentation**: https://vercel.com/docs
- **TanStack Start Docs**: https://tanstack.com/start
- **Notion API Docs**: https://developers.notion.com
- **Project GitHub**: (your repository)

## Cost Estimation

### Vercel Pricing (as of 2024)

**Hobby (Free)**

- Perfect for getting started
- Unlimited deployments
- 100 GB bandwidth/month
- Serverless function execution
- Automatic HTTPS

**Pro ($20/month)**

- For growing businesses
- Advanced analytics
- Password protection
- Preview deployment protection
- Team collaboration

**Recommended**: Start with Hobby, upgrade to Pro when:

- Exceeding free tier limits
- Need team features
- Want advanced analytics
- Require password protection

### Notion Pricing

- **Free**: Perfect for small salons (< 10 staff)
- **Plus ($10/user/month)**: Better for growing businesses
- **Unlimited**: Larger operations

---

## Quick Reference Commands

```bash
# Local development
pnpm dev

# Build for production
pnpm build

# Preview production build locally
pnpm preview

# Deploy to Vercel
vercel --prod

# View logs
vercel logs

# Check environment variables
vercel env ls

# Pull environment variables to local
vercel env pull
```

---

**Ready to Deploy!** ðŸš€

Follow this guide step-by-step for a smooth deployment process. If you encounter issues, check the troubleshooting section or reach out for support.

Good luck with your launch!
